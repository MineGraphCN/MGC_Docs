<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#FDB71B"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-04-11T15:20:08.54161316"><title>固体几何缓冲 | MineGraph Docs</title><script type="application/json" id="virtual-toc-data">[{"id":"xg7ug7_6","level":0,"title":"程序分类","anchor":"#xg7ug7_6"},{"id":"xg7ug7_7","level":0,"title":"纹理格式","anchor":"#xg7ug7_7"},{"id":"blend","level":0,"title":"混合","anchor":"#blend"},{"id":"xg7ug7_95","level":1,"title":"设置混合","anchor":"#xg7ug7_95"},{"id":"xg7ug7_9","level":0,"title":"渲染阶段","anchor":"#xg7ug7_9"},{"id":"xg7ug7_10","level":0,"title":"无遮蔽类","anchor":"#xg7ug7_10"},{"id":"xg7ug7_245","level":1,"title":"实体","anchor":"#xg7ug7_245"},{"id":"xg7ug7_246","level":1,"title":"发光实体","anchor":"#xg7ug7_246"},{"id":"xg7ug7_11","level":0,"title":"调试线框和拴绳","anchor":"#xg7ug7_11"},{"id":"xg7ug7_12","level":0,"title":"信标光柱","anchor":"#xg7ug7_12"},{"id":"xg7ug7_13","level":0,"title":"仅颜色类","anchor":"#xg7ug7_13"},{"id":"xg7ug7_318","level":1,"title":"天空","anchor":"#xg7ug7_318"},{"id":"xg7ug7_319","level":1,"title":"自发光类","anchor":"#xg7ug7_319"},{"id":"xg7ug7_320","level":1,"title":"挖掘裂纹","anchor":"#xg7ug7_320"},{"id":"xg7ug7_14","level":0,"title":"线框","anchor":"#xg7ug7_14"},{"id":"xg7ug7_15","level":0,"title":"习题","anchor":"#xg7ug7_15"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="frontend/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="MGC_Docs/page_logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="固体几何缓冲 | MineGraph Docs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="MineGraph Docs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://docs.minegraph.cn/md/2-1-solidgeometries.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="固体几何缓冲 | MineGraph Docs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://docs.minegraph.cn/md/2-1-solidgeometries.html#webpage",
    "url": "https://docs.minegraph.cn/md/2-1-solidgeometries.html",
    "name": "固体几何缓冲 | MineGraph Docs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://docs.minegraph.cn/md/#website",
    "url": "https://docs.minegraph.cn/md/",
    "name": "MineGraph Docs Help"
}</script><!-- End Schema.org --></head><body data-id="2-1-solidGeometries" data-main-title="固体几何缓冲" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="创作者文档///shaderTutorial.md|光影开发教程///我们需要再深入一些"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>MineGraph Docs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="2-1-solidGeometries" data-annotation-ids="wip" id="2-1-solidGeometries.md">固体几何缓冲</h1><div class="micro-format" data-content="{&quot;microFormat&quot;:[&quot;\u003cp id\u003d\&quot;xg7ug7_16\&quot;\u003e在上一章中，我们完成了一个几何缓冲并在延迟处理中渲染了动态阴影。但是上一章的内容还不足以构成一个哪怕可用的光影。从本章开始，我们将会从固体几何开始，逐步构建一个完整可用的光影。\u003c/p\u003e&quot;,&quot;\u003cp id\u003d\&quot;xg7ug7_17\&quot;\u003e本节我们将会逐个还原第一轮几何缓冲（即固体几何缓冲）中的内容。\u003c/p\u003e&quot;]}"></div><section class="chapter"><h2 id="xg7ug7_6" data-toc="xg7ug7_6">程序分类</h2><p id="xg7ug7_18">在 OptiFine 中，整个场景被拆分到了将近 20 个几何缓冲，要为它们逐一编写处理程序会给今后的修改带来很多不必要的麻烦。</p><p id="xg7ug7_19">大多数几何的处理方法应该是相似的，因此我们可以将它们分门别类，然后为每一类几何缓冲编写一个统一的程序。在之前，我们浅用了 <code class="code" id="xg7ug7_28">#include</code> 命令进行函数包含。这里我们将更进一步，使其包含整个着色器程序：</p><div class="code-block" data-lang="glsl">
#ifdef VERTEX_STAGE
[... 顶点着色器程序 ...]
#endif
#ifdef FRAGMENT_STAGE
[... 片段着色器程序 ...]
#endif
</div><p id="xg7ug7_21">将其放入一个新的文件夹 <code class="code" id="xg7ug7_29">shaders\programs\</code> ，这里的内容都是可以直接使用的着色器程序。最后在各几何缓冲的顶点和片段阶段调用对应的内容：</p><div class="code-block" data-lang="glsl">
#version 330 core
#define GBUFFER_SHADER
#define VERTEX_STAGE
#include &quot;/programs/&lt;程序&gt;&quot;
</div><p id="xg7ug7_23">有一些内容大致相同，但是存在细微差异的着色器程序，我们可以使用 <code class="code" id="xg7ug7_30">#ifdef</code> 进行判定。</p><p id="xg7ug7_24">在上一章中，我们已经处理完成了地形（<code class="code" id="xg7ug7_31">terrain</code> ），在几何缓冲中基本上就只有它会绘制环境光遮蔽，因此我们可以将其设置为单独的一类。为了便于今后的维护，即使只有一个几何缓冲使用的着色器我们也将会把主要的程序代码存入 <code class="code" id="xg7ug7_32">programs\</code> 下，对于 <code class="code" id="xg7ug7_33">terrain</code> 来说，我们直接使用同名文件 <code class="code" id="xg7ug7_34">gbuffers_terrain.glsl</code> 即可。</p><aside class="prompt" data-type="tip" data-title="" id="xg7ug7_25"><p id="xg7ug7_35">如果两个着色器程序之间有相同 <code class="code" id="xg7ug7_37">#include</code> 文件，则可以将它们提到顶部：</p><div class="code-block" data-lang="glsl">
#include &quot;/libs/Uniforms.glsl&quot;

#ifdef VERTEX_STAGE
[... 顶点着色器程序 ...]
#endif
#ifdef FRAGMENT_STAGE
[... 片段着色器程序 ...]
#endif
</div></aside><p id="xg7ug7_26">在本章中，我们的其他几何缓冲程序都将以 <code class="code" id="xg7ug7_38">terrain</code> 程序为蓝本编写。如果你忘记了我们之前的着色器，或者没有完成上一章提取原版光照强度的习题（不做作业可不行哦），这里有一份参考蓝本：</p><div class="code-collapse" data-lang="glsl" data-is-expanded="false" data-synopsis="gbuffers_terrain.glsl">
#include &quot;/libs/Uniforms.glsl&quot;

#ifdef VERTEX_STAGE
#include &quot;/libs/Attributes.glsl&quot;

out VS_OUT {
    vec4 color;
    vec2 uv;
    vec3 normal;
    vec2 vanillaLightStrength;
} vs_out;

void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(vaPosition + chunkOffset, 1.0);
    vs_out.color = vaColor;
    vs_out.normal = normalMatrix * vaNormal;
    vs_out.uv = vec2(textureMatrix * vec4(vaUV0, vec2(1.0)));
    vs_out.vanillaLightStrength = vec2(vaUV2 / 16) / textureSize(lightmap, 0);
}
#endif

#ifdef FRAGMENT_STAGE

in VS_OUT {
    vec4 color;
    vec2 uv;
    vec3 normal;
    vec2 vanillaLightStrength;
} fs_in;

/* DRAWBUFFERS:012 */
layout(location = 0) out vec4 fragColor;
layout(location = 1) out vec3 normals;
layout(location = 2) out vec2 light;

void main() {
    fragColor = texture(gtexture, fs_in.uv);
    if(fragColor.a &lt;= alphaTestRef) discard;
    fragColor.rgb *= fs_in.color.rgb;
    fragColor.a = fs_in.color.a;
    normals = fs_in.normal *.5+.5;
    light = fs_in.vanillaLightStrength;
}
#endif
</div></section><section class="chapter"><h2 id="xg7ug7_7" data-toc="xg7ug7_7">纹理格式</h2><p id="xg7ug7_39">回顾一下之前的教程，当我们向缓冲区写入内容之后，无论这个值多大，最终都会归一化到 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1722.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container> ，因此我们甚至在保存法线时都将它们重新映射到了 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1722.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container> 。这是因为用于输出的缓冲区默认格式是 <code class="code" id="xg7ug7_60">RGBA8</code> ，即每个像素四个通道，每个通道存储 8 位的归一化浮点。</p><p id="xg7ug7_40">在本教程中，我们会使用一个专门的缓冲区来输出每类几何独有的整型 ID，因此我们不希望缓冲区进行归一化，也不需要浮点类型。</p><p id="xg7ug7_41">OptiFine 允许我们使用常量表达式设置每个缓冲区的格式：</p><div class="code-block" data-lang="glsl">
const int colortex0Format = RGBA16F;
</div><p id="xg7ug7_43"><code class="code" id="xg7ug7_61">RGBA</code> 指定了缓冲区的通道数量， <code class="code" id="xg7ug7_62">16</code> 指定了每个通道的位数， <code class="code" id="xg7ug7_63">F</code> 则代表每个通道按不进行归一化的浮点数进行存储。</p><p id="xg7ug7_44">由于赋值的内容没有实际意义，OptiFine 也接受注释之后的内容，因此我们可以这样设置纹理缓冲区：</p><div class="code-block" data-lang="glsl">
/*
const int colortex0Format = RGBA16F;      // 不进行归一化，对我们之后要进行的 HDR 渲染很重要，当然你也可以使用 32 位浮点。
const int colortex1Format = RGB16_SNORM;  // 带符号的归一化，用于保存法线，并且不需要 Alpha 通道。
const int colortex2Format = RG16;         // 归一化的 16 位浮点值，用于原版光照强度。
const int colortex3Format = R8UI;         // 几何类型 ID，仅红色通道的 8 位整型。
*/
</div><p id="xg7ug7_46">我们将之前的法线缓冲区设置为了 <code class="code" id="xg7ug7_64">RGB16_SNORM</code> ，表示其保存的内容会保留符号进行归一化，因此在几何缓冲中我们不必将法线映射到 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1722.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container> 然后在延迟处理时将其又映射回 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="6.287ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2778.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mo" transform="translate(278,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(1056,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1556,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(2000.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2500.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container> 了，并且我们使用了 16 位的数据存储，因此还能提高不少数据精度。</p><p id="xg7ug7_47">我们还将之后会用来存储几何 ID 的 3 号缓冲区设置为了几乎最小的单通道八位无符号整型，可以为我们提供 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="8.53ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 3770.1 915.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g></g><g data-mml-node="mo" transform="translate(1214.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2270.1,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1000,0)"></path></g></g></g></svg></mjx-container> 个 ID。</p><aside class="prompt" data-type="tip" data-title="" id="xg7ug7_48"><p id="xg7ug7_68">深度缓冲区的格式强制为 <code class="code" id="xg7ug7_69">R32F</code> ，以保证存储的深度数据为最大精度。</p></aside><p id="xg7ug7_49">除此之外，如果我们要传入自定义纹理，也可以在光影配置文件中进行格式设置，不过那些都是后话了。</p><aside class="prompt" data-type="note" data-title="" id="xg7ug7_50"><p id="xg7ug7_70">你可以在 <a href="a04-textureandpx.html#texFormat" id="xg7ug7_72" data-tooltip="纹理格式">附录 4</a> 查阅 OptiFine 支持的纹理格式。</p><p id="xg7ug7_71">在我们的教程中不会刻意节省缓冲区通道，但是你可以通过习题 1 初步尝试将法线数据和光照数据保存在一起。</p></aside><p id="xg7ug7_51">当我们将纹理单元设置为整型数据保存时，可以在声明对应纹理时使用 <code class="code" id="xg7ug7_73">isampler2D</code> 来让 <code class="code" id="xg7ug7_74">texture()</code> 函数返回整型值：</p><div class="code-block" data-lang="glsl">
uniform isampler2D colortex3;
[... main ...]
int geoID = texture(colortex3, uv).r;
</div><aside class="prompt" data-type="tip" data-title="" id="xg7ug7_53"><p id="xg7ug7_75">除了 <code class="code" id="xg7ug7_76"><em id="xg7ug7_79">i</em>sampler</code> ，GLSL 还支持用 <code class="code" id="xg7ug7_77"><em id="xg7ug7_80">u</em>sampler</code> 声明无符号整数纹理采样器。在 GL 文档中，这种可选前缀的纹理类型被统一冠以 <span class="emphasis" id="xg7ug7_78"><code class="code" id="xg7ug7_81">g</code></span> 前缀。</p></aside><p id="xg7ug7_54">我们可以在任意一个着色器中设置纹理格式，但是最好还是保存在一个统一的地方，比如 <code class="code" id="xg7ug7_82">Settings.glsl</code> 的末尾。</p><p id="xg7ug7_55">我们要在每个程序中对 <code class="code" id="xg7ug7_83">colortex3</code> 输出几何 ID，并且不必再压缩法线数据，于是我们就要更改作为蓝本的 <code class="code" id="xg7ug7_84">terrain.glsl</code> 了：</p><div class="code-block" data-lang="glsl">
[...]
/* DRAWBUFFERS:0123 */
layout(location = 0) out vec4 fragColor;
layout(location = 1) out vec3 normals;
layout(location = 2) out vec2 light;
layout(location = 3) out int geometryID;
[... main ...]
normals = fs_in.normal;
geometryID = 1;
[...]
normals = fs_in.normal; // 可以正确保存 [-1,1] 区间上的内容，不再需要手动处理了
</div><p id="xg7ug7_57">除了前三个缓冲区，其他缓冲区默认的清空均为 <code class="code" id="xg7ug7_85">vec4(0.0)</code> ，由于天空是一个半圆形穹顶，而且覆盖范围大、靠近背景（&ldquo;天空&rdquo;和&ldquo;背景&rdquo;是两个概念！每一帧清空为了特定颜色之后的区域即为&ldquo;背景&rdquo;。），它最好不要写入 ID 以免不必要的麻烦。因此我们可以将除了天空之外的区域都设置为大于 0 的值，之后每次修改蓝本我们都应该更改对应的 <code class="code" id="xg7ug7_86">geometryID</code>。</p></section><section class="chapter"><h2 id="blend" data-toc="blend">混合</h2><p id="xg7ug7_87">由于几何缓冲程序向缓冲区输出内容之后不会翻转缓冲区，OptiFine 中的一些几何缓冲默认启用了<span class="control" id="xg7ug7_96">混合</span> （Blending）。GL 可以通过<span class="control" id="xg7ug7_97">混合方程</span> （Blend Equation）让一些内容在输出时与缓冲区上已有内容进行色彩混合。</p><div><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="32.814ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 14503.7 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">结</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">果</text></g></g></g><g data-mml-node="mo" transform="translate(2490,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(3545.8,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(5273.1,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(6273.3,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(7928.6,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(8928.9,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="mo" transform="translate(11363.3,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(12363.5,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container></div><p id="xg7ug7_89">其中<br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="5.005ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 2212.2 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">结</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">果</text></g></g></g></g></g></svg></mjx-container> 表示混合结果； <br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="3.405ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 1505.1 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container> 表示源（从程序输出）颜色； <br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="3.242ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 1433.1 998.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container> 表示源因子，决定源颜色的乘数； <br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="5.005ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 2212.2 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container> 表示目标（缓冲区中）颜色； <br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="4.842ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 2140.2 998.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container> 表示目标因子，决定目标颜色的乘数。</p><p id="xg7ug7_90">例如，当我们将 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="3.242ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 1433.1 998.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container> 设置为源的 Alpha 通道 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="3.484ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 1540.1 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container> ，然后将 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="4.842ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 2140.2 998.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container> 设置为 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="7.381ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 3262.6 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container> ，则最终的颜色为</p><div><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="37.355ex" height="2.417ex" role="img" focusable="false" viewBox="0 -750 16511.1 1068.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">结</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">果</text></g></g></g><g data-mml-node="mo" transform="translate(2490,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(3545.8,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(5273.1,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(6273.3,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(8035.6,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(9035.9,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="mo" transform="translate(11470.3,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mo" transform="translate(12470.5,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(12859.5,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(13581.8,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(14582,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(16122.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></div><p id="xg7ug7_92">即将源颜色根据其不透明度与缓冲区的颜色进行混合，效果与 <code class="code" id="xg7ug7_112">mix(SRC_COLOR, DST_COLOR, SRC_ALPHA)</code> 相同。</p><p id="xg7ug7_93">此外，OptiFine 允许我们单独对 Alpha 通道设置混合方式：</p><div><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="42.298ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 18695.8 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">结</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">果</text></g></g></g><g data-mml-node="mo" transform="translate(2525,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(3580.8,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(5343.1,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(6343.3,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text><path data-c="20" d="" transform="translate(1000,0)"></path><path data-c="41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z" transform="translate(1250,0)"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(2000,0)"></path><path data-c="70" d="M36 -148H50Q89 -148 97 -134V-126Q97 -119 97 -107T97 -77T98 -38T98 6T98 55T98 106Q98 140 98 177T98 243T98 296T97 335T97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 61 434T98 436Q115 437 135 438T165 441T176 442H179V416L180 390L188 397Q247 441 326 441Q407 441 464 377T522 216Q522 115 457 52T310 -11Q242 -11 190 33L182 40V-45V-101Q182 -128 184 -134T195 -145Q216 -148 244 -148H260V-194H252L228 -193Q205 -192 178 -192T140 -191Q37 -191 28 -194H20V-148H36ZM424 218Q424 292 390 347T305 402Q234 402 182 337V98Q222 26 294 26Q345 26 384 80T424 218Z" transform="translate(2278,0)"></path><path data-c="68" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 124T102 167T103 217T103 272T103 329Q103 366 103 407T103 482T102 542T102 586T102 603Q99 622 88 628T43 637H25V660Q25 683 27 683L37 684Q47 685 66 686T103 688Q120 689 140 690T170 693T181 694H184V367Q244 442 328 442Q451 442 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(2834,0)"></path><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(3390,0)"></path></g></g></g><g data-mml-node="mo" transform="translate(10042.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(11042.4,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="mo" transform="translate(13511.8,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(14512.1,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text><path data-c="20" d="" transform="translate(2000,0)"></path><path data-c="41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z" transform="translate(2250,0)"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(3000,0)"></path><path data-c="70" d="M36 -148H50Q89 -148 97 -134V-126Q97 -119 97 -107T97 -77T98 -38T98 6T98 55T98 106Q98 140 98 177T98 243T98 296T97 335T97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 61 434T98 436Q115 437 135 438T165 441T176 442H179V416L180 390L188 397Q247 441 326 441Q407 441 464 377T522 216Q522 115 457 52T310 -11Q242 -11 190 33L182 40V-45V-101Q182 -128 184 -134T195 -145Q216 -148 244 -148H260V-194H252L228 -193Q205 -192 178 -192T140 -191Q37 -191 28 -194H20V-148H36ZM424 218Q424 292 390 347T305 402Q234 402 182 337V98Q222 26 294 26Q345 26 384 80T424 218Z" transform="translate(3278,0)"></path><path data-c="68" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 124T102 167T103 217T103 272T103 329Q103 366 103 407T103 482T102 542T102 586T102 603Q99 622 88 628T43 637H25V660Q25 683 27 683L37 684Q47 685 66 686T103 688Q120 689 140 690T170 693T181 694H184V367Q244 442 328 442Q451 442 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(3834,0)"></path><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(4390,0)"></path></g></g></g></g></g></svg></mjx-container></div><section class="chapter"><h3 id="xg7ug7_95" data-toc="xg7ug7_95">设置混合</h3><p id="xg7ug7_113">我们可以在 <code class="code" id="xg7ug7_124">shaders.properties</code> 中使用 <code class="code" id="xg7ug7_125">blend.&lt;程序&gt;</code> 按</p><div><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="32.203ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 14233.7 998.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mstyle" transform="translate(1433.1,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="msub" transform="translate(2433.1,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="mstyle" transform="translate(4573.3,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="msub" transform="translate(5573.3,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text><path data-c="20" d="" transform="translate(1000,0)"></path><path data-c="41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z" transform="translate(1250,0)"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(2000,0)"></path><path data-c="70" d="M36 -148H50Q89 -148 97 -134V-126Q97 -119 97 -107T97 -77T98 -38T98 6T98 55T98 106Q98 140 98 177T98 243T98 296T97 335T97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 61 434T98 436Q115 437 135 438T165 441T176 442H179V416L180 390L188 397Q247 441 326 441Q407 441 464 377T522 216Q522 115 457 52T310 -11Q242 -11 190 33L182 40V-45V-101Q182 -128 184 -134T195 -145Q216 -148 244 -148H260V-194H252L228 -193Q205 -192 178 -192T140 -191Q37 -191 28 -194H20V-148H36ZM424 218Q424 292 390 347T305 402Q234 402 182 337V98Q222 26 294 26Q345 26 384 80T424 218Z" transform="translate(2278,0)"></path><path data-c="68" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 124T102 167T103 217T103 272T103 329Q103 366 103 407T103 482T102 542T102 586T102 603Q99 622 88 628T43 637H25V660Q25 683 27 683L37 684Q47 685 66 686T103 688Q120 689 140 690T170 693T181 694H184V367Q244 442 328 442Q451 442 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(2834,0)"></path><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(3390,0)"></path></g></g></g><g data-mml-node="mstyle" transform="translate(9050,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="msub" transform="translate(10050,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(676,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text><path data-c="20" d="" transform="translate(2000,0)"></path><path data-c="41" d="M255 0Q240 3 140 3Q48 3 39 0H32V46H47Q119 49 139 88Q140 91 192 245T295 553T348 708Q351 716 366 716H376Q396 715 400 709Q402 707 508 390L617 67Q624 54 636 51T687 46H717V0H708Q699 3 581 3Q458 3 437 0H427V46H440Q510 46 510 64Q510 66 486 138L462 209H229L209 150Q189 91 189 85Q189 72 209 59T259 46H264V0H255ZM447 255L345 557L244 256Q244 255 345 255H447Z" transform="translate(2250,0)"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(3000,0)"></path><path data-c="70" d="M36 -148H50Q89 -148 97 -134V-126Q97 -119 97 -107T97 -77T98 -38T98 6T98 55T98 106Q98 140 98 177T98 243T98 296T97 335T97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 61 434T98 436Q115 437 135 438T165 441T176 442H179V416L180 390L188 397Q247 441 326 441Q407 441 464 377T522 216Q522 115 457 52T310 -11Q242 -11 190 33L182 40V-45V-101Q182 -128 184 -134T195 -145Q216 -148 244 -148H260V-194H252L228 -193Q205 -192 178 -192T140 -191Q37 -191 28 -194H20V-148H36ZM424 218Q424 292 390 347T305 402Q234 402 182 337V98Q222 26 294 26Q345 26 384 80T424 218Z" transform="translate(3278,0)"></path><path data-c="68" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 124T102 167T103 217T103 272T103 329Q103 366 103 407T103 482T102 542T102 586T102 603Q99 622 88 628T43 637H25V660Q25 683 27 683L37 684Q47 685 66 686T103 688Q120 689 140 690T170 693T181 694H184V367Q244 442 328 442Q451 442 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(3834,0)"></path><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(4390,0)"></path></g></g></g></g></g></svg></mjx-container></div><p id="xg7ug7_115">的顺序设置混合因子 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.695ex" height="1.538ex" role="img" focusable="false" viewBox="0 -680 749 680"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg></mjx-container>：</p><div class="code-block" data-lang="properties">
blend.&lt;程序&gt;=&lt;off|src dst srcA dstA&gt;
</div><p id="xg7ug7_117">每个因子可以使用下列参数：</p><div class="table-wrapper"><table class="wide" id="xg7ug7_118" width="700"><thead><tr class="ijRowHead" id="xg7ug7_127"><th id="xg7ug7_140"><p>参数</p></th><th id="xg7ug7_141"><p>值</p></th><th id="xg7ug7_142"><p>备注</p></th></tr></thead><tbody><tr id="xg7ug7_128"><td id="xg7ug7_143"><p><code class="code" id="xg7ug7_146">off</code></p></td><td id="xg7ug7_144"><p>禁用混合</p></td><td id="xg7ug7_145"><p>只需设置一个因子</p></td></tr><tr id="xg7ug7_129"><td id="xg7ug7_147"><p><code class="code" id="xg7ug7_150">ZERO</code></p></td><td id="xg7ug7_148"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_149"></td></tr><tr id="xg7ug7_130"><td id="xg7ug7_152"><p><code class="code" id="xg7ug7_155">ONE</code></p></td><td id="xg7ug7_153"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_154"></td></tr><tr id="xg7ug7_131"><td id="xg7ug7_157"><p><code class="code" id="xg7ug7_160">SRC_COLOR</code></p></td><td id="xg7ug7_158"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="3.405ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 1505.1 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_159"><p>各通道独立相乘</p></td></tr><tr id="xg7ug7_132"><td id="xg7ug7_162"><p><code class="code" id="xg7ug7_165">ONE_MINUS_SRC_COLOR</code></p></td><td id="xg7ug7_163"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="7.302ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 3227.6 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_164"><p>各通道独立相乘</p></td></tr><tr id="xg7ug7_133"><td id="xg7ug7_167"><p><code class="code" id="xg7ug7_170">DST_COLOR</code></p></td><td id="xg7ug7_168"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="5.005ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 2212.2 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_169"><p>各通道独立相乘</p></td></tr><tr id="xg7ug7_134"><td id="xg7ug7_172"><p><code class="code" id="xg7ug7_175">ONE_MINUS_DST_COLOR</code></p></td><td id="xg7ug7_173"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="8.902ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 3934.7 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_174"><p>各通道独立相乘</p></td></tr><tr id="xg7ug7_135"><td id="xg7ug7_177"><p><code class="code" id="xg7ug7_180">SRC_ALPHA</code></p></td><td id="xg7ug7_178"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="3.484ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 1540.1 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_179"></td></tr><tr id="xg7ug7_136"><td id="xg7ug7_182"><p><code class="code" id="xg7ug7_185">ONE_MINUS_SRC_ALPHA</code></p></td><td id="xg7ug7_183"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="7.381ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 3262.6 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_184"></td></tr><tr id="xg7ug7_137"><td id="xg7ug7_187"><p><code class="code" id="xg7ug7_190">DST_ALPHA</code></p></td><td id="xg7ug7_188"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="5.084ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 2247.2 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_189"></td></tr><tr id="xg7ug7_138"><td id="xg7ug7_192"><p><code class="code" id="xg7ug7_195">ONE_MINUS_DST_ALPHA</code></p></td><td id="xg7ug7_193"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="8.981ex" height="2.34ex" role="img" focusable="false" viewBox="0 -716 3969.7 1034.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_194"></td></tr><tr id="xg7ug7_139"><td id="xg7ug7_197"><p><code class="code" id="xg7ug7_200">SRC_ALPHA_SATURATE</code></p></td><td id="xg7ug7_198"><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="19.003ex" height="2.417ex" role="img" focusable="false" viewBox="0 -750 8399.4 1068.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(833,0)"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(1111,0)"></path></g><g data-mml-node="mo" transform="translate(1667,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(2056,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(3596.1,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(4040.8,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(4763,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(5763.2,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(783,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="mo" transform="translate(8010.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></p></td><td id="xg7ug7_199"></td></tr></tbody></table></div><p id="xg7ug7_119">也可以逐个缓冲区设置混合模式：</p><div class="code-block" data-lang="properties">
blend.&lt;程序&gt;.&lt;纹理ID&gt;=&lt;off|src dst srcA dstA&gt;
</div><aside class="prompt" data-type="tip" data-title="" id="xg7ug7_121"><p id="xg7ug7_202"><code class="code" id="xg7ug7_203">off</code> 的效果与 <code class="code" id="xg7ug7_204">ONE ZERO ONE ZERO</code> 相同，它们都是将源数据完全覆盖目标数据。</p></aside><ul class="list _bullet" id="xg7ug7_122"><li class="list__item" id="xg7ug7_205"><p id="xg7ug7_209">实体（<code class="code" id="xg7ug7_210">entities</code> ）、发光实体（<code class="code" id="xg7ug7_211">entities_glowing</code> ）、第一人称手部（<code class="code" id="xg7ug7_212">hand</code> ）和有厚度线框（<code class="code" id="xg7ug7_213">line</code> ）默认启用了前文中&ldquo;与 <code class="code" id="xg7ug7_214">mix()</code> 相似&rdquo;的混合方法（<code class="code" id="xg7ug7_215">SRC_ALPHA ONE_MINUS_SRC_ALPHA SRC_ALPHA ONE_MINUS_SRC_ALPHA</code>）；</p></li><li class="list__item" id="xg7ug7_206"><p id="xg7ug7_216">挖掘裂纹（<code class="code" id="xg7ug7_217">damagedblock</code> ）而使用了相互相乘再相加的混合方法，并保留了挖掘裂纹 Alpha 值（<code class="code" id="xg7ug7_218">DST_COLOR SRC_COLOR ONE ZERO</code> <span id="xg7ug7_219"><sup class="superscript"><span class="control" id="xg7ug7_220">1</span></sup></span>）；</p></li><li class="list__item" id="xg7ug7_207"><p id="xg7ug7_221">第一轮的其他几何缓冲默认禁用混合；</p></li><li class="list__item" id="xg7ug7_208"><p id="xg7ug7_222">你可以在 <a href="a04-textureandpx.html#texID" id="xg7ug7_223" data-tooltip="">纹理单元 ID</a> 查询纹理 ID。</p></li></ul><p id="xg7ug7_123"><span class="control" id="xg7ug7_224">[1]</span> 即 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.72ex;" xmlns="http://www.w3.org/2000/svg" width="42.933ex" height="2.315ex" role="img" focusable="false" viewBox="0 -705 18976.2 1023.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">结</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">果</text></g></g></g><g data-mml-node="mo" transform="translate(2490,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(3545.8,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="msub" transform="translate(5050.9,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="mo" transform="translate(7485.3,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(8485.5,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g><g data-mml-node="msub" transform="translate(10697.7,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="mo" transform="translate(12480.6,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(13536.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(14258.6,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(15258.9,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">源</text></g></g></g><g data-mml-node="msub" transform="translate(16764,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="TeXAtom" transform="translate(748,-176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mtext"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text><text data-variant="normal" transform="translate(1000,0) scale(1,-1)" font-size="884px" font-family="serif">标</text></g></g></g></g></g></svg></mjx-container> ，最终表现为当裂纹纹理颜色值小于 0.5 时变暗，大于 0.5 时变亮。</p></section></section><section class="chapter"><h2 id="xg7ug7_9" data-toc="xg7ug7_9">渲染阶段</h2><p id="xg7ug7_226">渲染阶段（Render Stage）是 OptiFine 提供的众多标准宏之一。由于部分几何缓冲中包含了不止一种几何 <span id="xg7ug7_231"><sup class="superscript"><span class="control" id="xg7ug7_234">1</span></sup></span> ，OptiFine 允许我们使用这种宏和提供的统一变量 <code class="code" id="xg7ug7_232">renderStage</code> 进行阶段判定，比如在 <code class="code" id="xg7ug7_233">skybasic</code> 中只保留天空中的星星：</p><div class="code-block" data-lang="glsl">
[...]
uniform int renderStage;
[... main ...]
if(renderStage != MC_RENDER_STAGE_STARS) discard;
</div><p id="xg7ug7_228">其中， <code class="code" id="xg7ug7_235">MC_RENDER_STAGE_STARS</code> 由 OptiFine 在编译时自动在程序顶部定义，我们无需手动声明。</p><p id="xg7ug7_229"><span class="control" id="xg7ug7_236">[1]</span> 比如 <code class="code" id="xg7ug7_237">skybasic</code> 中不仅负责渲染天空，还负责渲染星星； <code class="code" id="xg7ug7_238">basic</code> 中不仅有调试线框，还有拴绳。</p><p id="xg7ug7_230">你可以在 <a href="a01-uniformsandats.html#renderStage" id="xg7ug7_239" data-tooltip="OptiFine 提供的数据 - 标准宏 - 渲染阶段">附录 1</a> 查询所有可用的渲染阶段宏。</p></section><section class="chapter"><h2 id="xg7ug7_10" data-toc="xg7ug7_10">无遮蔽类</h2><p id="xg7ug7_240">所谓的无遮蔽类基本上就是除了固体和裁切地形之外，照常接受光照的内容。由于不需要遮蔽和半透明处理，我们可以像没有 AO 数据那样进行 Alpha 测试，并在这之后将输出颜色的 Alpha 设置为 <code class="code" id="xg7ug7_247">1.0</code>。</p><p id="xg7ug7_241">它们和地形的在延迟处理中的渲染方法没有什么本质区别，而且我们已经手动将环境光遮蔽禁用了，因此也不需要更改几何 ID。</p><div class="code-block" data-lang="glsl">
[... main ...]
fragColor = texture(gtexture, fs_in.uv) * fs_in.color;
if(fragColor.a &lt;= alphaTestRef) discard;
fragColor.a = 1.0;
</div><p id="xg7ug7_243">属于无遮蔽类的程序包括 <code class="code" id="xg7ug7_248">hand</code> 和 <code class="code" id="xg7ug7_249">block</code> ，考虑到一些模组可能会优化方块实体的渲染，为其添加 AO，你也可以将它像地形那样渲染。</p><p id="xg7ug7_244">无遮蔽类的专用几何缓冲程序我们保存在 <code class="code" id="xg7ug7_250">gbuffers_aoLess.glsl</code> 中。</p><section class="chapter"><h3 id="xg7ug7_245" data-toc="xg7ug7_245">实体</h3><p id="xg7ug7_251">虽然 <code class="code" id="xg7ug7_270">entities</code> 本来也应该算在其中，但是当我们进入旁观模式之后，我们旁观者本身和隐身的玩家会变为<span class="control" id="xg7ug7_271">半透明渲染</span> 。这也是实体默认启用混合的原因之一。</p><p id="xg7ug7_252">但是游戏并不会将我们视为半透明几何，不仅会将我们写入 0 号深度缓冲区，而且如果这类实体遮挡在半透明几何上，背后的水体会直接不渲染 <span id="xg7ug7_272"><sup class="superscript"><span class="control" id="xg7ug7_275">1</span></sup></span> ，因为水体的深度大于了当前深度，GL 认为水体被遮挡。同时，GL 也不会执行半透明排序 <span id="xg7ug7_273"><sup class="superscript"><span class="control" id="xg7ug7_276">2</span></sup></span> ，因此当半透明实体在屏幕上相互重叠时也会造成随机的遮挡。 <span id="xg7ug7_274"><span class="text-line-through">沟槽的 <code class="code" id="xg7ug7_277">entities</code>。</span></span></p><p id="xg7ug7_253"><span class="control" id="xg7ug7_278">[1]</span> 因为水体在第二轮几何缓冲才渲染，迟于实体；地形之类早于实体渲染的几何体就不会被遮挡。 <br><span class="control" id="xg7ug7_280">[2]</span> 这是一种确保半透明由远向近渲染的功能，这样当近处的半透明几何渲染之后就不会遮挡远处的几何了。</p><p id="xg7ug7_254">如果你不希望实体进入阴影贴图，可以使用</p><div class="code-block" data-lang="properties">
shadowEntities = false
</div><p id="xg7ug7_256">来禁用阴影缓冲中渲染实体几何。</p><p id="xg7ug7_257">这里我们提供两种解决方案，第一种是在光影配置中禁用混合：</p><div class="code-block" data-lang="properties">
blend.gbuffers_entities=off
</div><p id="xg7ug7_259">然后为这类实体设置一个独立的几何 ID，以便在延迟处理中为它们编写其他效果（当然半透明就无法实现了）：</p><div class="code-block" data-lang="glsl">
[... main ...]
if(fs_in.color.a &lt; 0.9) {
    geometryID = 2;
} else {
    geometryID = 1;
}
</div><aside class="prompt" data-type="note" data-title="" id="xg7ug7_261"><p id="xg7ug7_281">由于顶点数据在传输时会进行插值，所以不要使用严格的 <code class="code" id="xg7ug7_282">fs_in.color.a &lt; 1.0</code> 进行判定</p></aside><p id="xg7ug7_262">另一种是不处理半透明实体的光照，在光影配置中仅开启颜色缓冲区的混合，然后完全保留实体的不透明度：</p><div class="code-block" data-lang="properties">
blend.gbuffers_entities=off
blend.gbuffers_entities.colortex0=SRC_ALPHA ONE_MINUS_SRC_ALPHA ONE ZERO
</div><p id="xg7ug7_264">然后在片段着色器中<span class="control" id="xg7ug7_283">不要将 <code class="code" id="xg7ug7_284">fragColor.a</code> 覆写为 <code class="code" id="xg7ug7_285">fs_in.color.a</code></span>：</p><div class="code-block" data-lang="glsl">
[... main ...]
fragColor = texture(gtexture, fs_in.uv) * fs_in.color;
if(fragColor.a &lt;= alphaTestRef) discard;
[...]
if(fs_in.color.a &lt; 0.9) {
    geometryID = 2;
} else {
    geometryID = 1;
}
</div><p id="xg7ug7_266">最后，在延迟处理中处理光照时，检查几何 ID，如果是半透明实体则按比例处理光照但不处理 AO，将我们之前所写的延迟渲染改写为：</p><div class="code-block" data-lang="glsl">
int geoID = texture(colortex3, uv).r;
[...]
if(geoID == 2) {
    lit = mix(lit * shadowMultiplier * 0.6 + 0.4, 1.0, albedo.a);
}
else {
    lit = lit * shadowMultiplier * 0.6 + 0.4 * albedo.a;
}
fragColor = albedo * lit;
</div><p id="xg7ug7_268">当然，这两种方法都有着一定程度上的妥协，你也可以自行思考一些方法。在下一节中，我们会介绍以图像（Image）格式加载缓冲区的方法，这样我们就能在几何缓冲中访问 0~3 号缓冲区，并提出一种比较取巧的将隐身实体作为无光照类的解决方法。</p><p id="xg7ug7_269">实体的专用几何缓冲程序我们保存在 <code class="code" id="xg7ug7_286">gbuffers_entities.glsl</code> 中。</p></section><section class="chapter"><h3 id="xg7ug7_246" data-toc="xg7ug7_246">发光实体</h3><p id="xg7ug7_287"><code class="code" id="xg7ug7_296">entities_glowing</code> 的处理比较麻烦，因为它们需要始终在屏幕上，最简单的办法就是手动将它们的深度设置为 <code class="code" id="xg7ug7_297">0.0</code></p><div class="code-block" data-lang="glsl">
gl_FragDepth = 0.0;
geometryID = 3;
</div><p id="xg7ug7_289">这样就一定在最靠近屏幕的地方渲染，但是三角形的排序不同。当然，你也可以不将它们的深度提到最前，只更改几何 ID，但是这样就无法透过墙壁看到实体。</p><p id="xg7ug7_290">我们这里会仅将几何 ID 设置为 4，在之后的程序中它会表示不处理光照的类型。</p><p id="xg7ug7_291">当然，发光实体同时也可以是隐身实体，如果你想的话，也可以像发光实体那样为它做特殊处理，但是我们这里就将其视为完全不透明实体了：</p><div class="code-block" data-lang="properties">
blend.gbuffers_entities_glowing=off
</div><p id="xg7ug7_293">如果想实现类似原版那种描边效果，我们同样需要等到下一节才能处理 <span id="xg7ug7_298"><sup class="superscript"><span class="control" id="xg7ug7_299">1</span></sup></span> 。在这里，我们临时将几何 ID 设置为一个不同于实体的值备用。</p><p id="xg7ug7_294"><span class="control" id="xg7ug7_300">[1]</span> 原版使用了专用的轮廓帧缓冲进行处理，可以不进行深度比较，但是我们没有办法这样做。并且还使用了两个 Pass 进行延迟处理，我们也会在下一节认识。</p><p id="xg7ug7_295">发光实体的专用几何缓冲程序我们保存在 <code class="code" id="xg7ug7_301">gbuffers_entities_glowing.glsl</code> 中。</p></section></section><section class="chapter"><h2 id="xg7ug7_11" data-toc="xg7ug7_11">调试线框和拴绳</h2><p id="xg7ug7_302">调试线框（区块边界框）和拴绳都在 <code class="code" id="xg7ug7_307">basic</code> 中处理，不需要在片段着色器中进行纹理采样，因此我们的顶点着色器不必传出纹理坐标。</p><div class="code-block" data-lang="glsl">
[... 顶点着色器 ...]
out VS_OUT {
    vec4 color;
    vec3 normal;
    vec2 vanillaLightStrength;
} vs_out;
[... 片段着色器 ...]
in VS_OUT {
    vec4 color;
    vec3 normal;
    vec2 vanillaLightStrength;
} fs_in;
[... main ...]
fragColor = fs_in.color;
if(fragColor.a &lt;= alphaTestRef) discard;
fragColor.a = 1.0;
</div><p id="xg7ug7_304">由于区块边界框不需要接受光照，而拴绳可以按照无遮蔽类处理，我们可以利用渲染阶段进行判定：</p><div class="code-block" data-lang="glsl">
if(renderStage != MC_RENDER_STAGE_DEBUG) geometryID = 1;
else geometryID = 4;
</div><p id="xg7ug7_306">线框的专用几何缓冲程序我们保存在 <code class="code" id="xg7ug7_308">gbuffers_basic.glsl</code> 中。</p></section><section class="chapter"><h2 id="xg7ug7_12" data-toc="xg7ug7_12">信标光柱</h2><p id="xg7ug7_309">信标光柱不需要处理光照，因此只需要将光柱简单地写入颜色缓冲，然后将几何 ID 设置为和 <code class="code" id="xg7ug7_313">basic</code> 中一样不需要处理光照的 <code class="code" id="xg7ug7_314">4</code> ，如果你之后还想处理其他效果，也可以将其设置为一个唯一值。</p><p id="xg7ug7_310">值得注意的是，信标光柱外围有一圈半透明的<span class="control" id="xg7ug7_315">负几何</span> ，类似新版红石火把的外围方块，它们只渲染背面。你可以像实体那样直接忽略透明度或设置为不处理 AO，在这里我们也暂时按照前者处理。</p><div class="code-block" data-lang="glsl">
[... 片段着色器 ...]
/* DRAWBUFFERS:03 */
layout(location = 0) out vec4 fragColor;
layout(location = 1) out int geometryID;
[... main ...]
geometryID = 4;
</div><p id="xg7ug7_312">信标光柱的专用着色器我们保存在 <code class="code" id="xg7ug7_316">gbuffers_beaconbeam.glsl</code> 中。</p></section><section class="chapter"><h2 id="xg7ug7_13" data-toc="xg7ug7_13">仅颜色类</h2><p id="xg7ug7_317">所谓的仅颜色类就是只输出到颜色缓冲区，不需要写入其他信息的类。</p><section class="chapter"><h3 id="xg7ug7_318" data-toc="xg7ug7_318">天空</h3><p id="xg7ug7_321">天空包括 <code class="code" id="xg7ug7_325">skybasic</code> 和 <code class="code" id="xg7ug7_326">skytextured</code> ，唯一的区别是前者没有纹理，因此我们可以将它们整合进同一个程序中，然后通过宏来判断需不需要纹理：</p><div class="code-block" data-lang="glsl">
[... 顶点着色器 ...]
out VS_OUT {
    vec4 color;
    #ifdef TEXTURED_SHADER
    vec2 uv;
    #endif
} vs_out;
[... main ...]
#ifdef TEXTURED_SHADER
vs_out.uv = vaUV0;
#endif
[... 片段着色器 ...]
in VS_OUT {
    vec4 color;
    #ifdef TEXTURED_SHADER
    vec2 uv;
    #endif
} fs_in;
[... main ...]
#ifdef TEXTURED_SHADER
fragColor = texture(gtexture, fs_in.uv) * fs_in.color;
#else
fragColor = fs_in.color;
#endif
</div><p id="xg7ug7_323">最后在 <code class="code" id="xg7ug7_327">skytextured</code> 中包含文件之前声明 <code class="code" id="xg7ug7_328">TEXTURED_SHADER</code> 即可：</p><div class="code-block" data-lang="glsl">
#define TEXTURED_SHADER
</div></section><section class="chapter"><h3 id="xg7ug7_319" data-toc="xg7ug7_319">自发光类</h3><p id="xg7ug7_329">自发光类直接将它们的内容根据不透明度与背景本身相加即可（我们之前不归一化的 0 号缓冲区已经起了一些作用了），不必写入几何 ID 和其他信息。</p><p id="xg7ug7_330">自发光类包括 <code class="code" id="xg7ug7_333">spidereyes</code> 和 <code class="code" id="xg7ug7_334">armor_glint</code> ，我们可以共用天空所使用的程序，但是记得添加宏定义和更改混合方式：</p><div class="code-block" data-lang="glsl">
#define TEXTURED_SHADER
</div><div class="code-block" data-lang="properties">
blend.gbuffers_spidereyes=SRC_ALPHA ONE ZERO ONE
blend.gbuffers_armor_glint=SRC_ALPHA ONE ZERO ONE
</div></section><section class="chapter"><h3 id="xg7ug7_320" data-toc="xg7ug7_320">挖掘裂纹</h3><p id="xg7ug7_335"><code class="code" id="xg7ug7_340">damagedblock</code> 实际上是覆盖在正在挖掘的表面上稍大的一个几何体，我们通常只对其进行颜色混合，并忽略其他内容。</p><p id="xg7ug7_336">挖掘裂纹的默认混合模式比较特殊，是将裂痕的颜色与之前的几何缓冲颜色相乘再相加（<code class="code" id="xg7ug7_341">DST_COLOR SRC_COLOR</code> ），只不过裂纹区域的默认混合方式是仅保留裂纹的 Alpha 值（<code class="code" id="xg7ug7_342">ONE ZERO</code>）。</p><p id="xg7ug7_337">我们不需要裂纹的 Alpha，也不需要它覆写几何 ID，更不需要覆写法线等信息，它们通常很贴合方块表面，因此可以让它照常写入深度。因此我们也可以像自发光类那样定义 <code class="code" id="xg7ug7_343">TEXTURED_SHADER</code> 并调用同样的程序，只是要记得把混合模式改为</p><div class="code-block" data-lang="properties">
blend.gbuffers_damagedblock=DST_COLOR SRC_COLOR ZERO ONE
</div><p id="xg7ug7_339">仅颜色类专用的几何缓冲程序我们保存在 <code class="code" id="xg7ug7_344">gbuffers_color_only.glsl</code> 中。</p></section></section><section class="chapter"><h2 id="xg7ug7_14" data-toc="xg7ug7_14">线框</h2><p id="xg7ug7_345"><code class="code" id="xg7ug7_371">line</code> 中像方块选择框这种顶点本身的厚度其实只有 1 像素，因此原版的顶点着色器对它们进行了特殊处理，我们将会参考原版着色器来编写。</p><p id="xg7ug7_346">片段着色器比较麻烦，因为线框实际上是半透明的，在这里先提供多种方法处理它们：</p><ul class="list _bullet" id="xg7ug7_347"><li class="list__item" id="xg7ug7_372"><p id="xg7ug7_374">作为世界中的几何体绘制</p><ul class="list _bullet" id="xg7ug7_375"><li class="list__item" id="xg7ug7_376"><p id="xg7ug7_378">禁用混合，直接忽略不透明度，将它作为无遮蔽类那样处理。副作用是会参与到后处理中其他效果，视你的喜好而定。</p></li><li class="list__item" id="xg7ug7_377"><p id="xg7ug7_379">禁用混合，将内容连带不透明度写入单独的缓冲区，在之后的延迟渲染中单独处理它们，并按需进行混合，这样就可以保留半透明效果。</p></li></ul></li><li class="list__item" id="xg7ug7_373"><p id="xg7ug7_380">作为 HUD 绘制</p><ul class="list _bullet" id="xg7ug7_381"><li class="list__item" id="xg7ug7_382"><p id="xg7ug7_385">禁用混合，忽略不透明度，仅写入颜色缓冲区（0 号缓冲区），然后在后期所有效果都忽略这片区域，副作用是模糊和扭曲类的效果可能会采样到这片区域，需要手动判断。</p></li><li class="list__item" id="xg7ug7_383"><p id="xg7ug7_386">和实体的第二种方案类似，启用混合，只保留线框的 Alpha 通道，副作用是线框覆盖范围背后的 AO 无法渲染。</p></li><li class="list__item" id="xg7ug7_384"><p id="xg7ug7_387">禁用混合，将内容连带不透明度写入单独的缓冲区，然后在着色器的最末端将它们混合到输出内容中。</p></li></ul></li></ul><p id="xg7ug7_348">在这里，我们直接将线框视为世界中的几何体，忽略光照并禁用混合，因此顶点着色器中的输出也就只有颜色了：</p><div class="code-block" data-lang="glsl">
out VS_OUT {
    vec4 color;
} vs_out;
</div><p id="xg7ug7_350">此外，我们还需要定义一个线条宽度 <code class="code" id="xg7ug7_388">LineWidth</code> 和线条偏移量 <code class="code" id="xg7ug7_389">VIEW_SHRINK</code> ，后者会用来向摄像机偏移一小段距离，以免某些夹缝中的边框被遮挡：</p><div class="code-block" data-lang="glsl">
const float LineWidth = 2.5;
const float VIEW_SHRINK = 255.0 / 256.0;
const vec4 VIEW_SCALE = vec4(vec3(VIEW_SHRINK), 1.0);
</div><p id="xg7ug7_352">在原版中，Mojang 将 <code class="code" id="xg7ug7_390">VIEW_SHRINK</code> 设置为 <code class="code" id="xg7ug7_391">1.0 - (1.0 / 256.0)</code> 并将 <code class="code" id="xg7ug7_392">VIEW_SCALE</code> 组成了一个 <code class="code" id="xg7ug7_393">mat4(VIEW_SHRINK, VIEW_SHRINK, VIEW_SHRINK, 1.0)</code> 的对角方阵，但是在这里我们将其改写为一个等效的向量以减少一些计算量。</p><p id="xg7ug7_353">在顶点着色器中，我们需要先手动进行透视除法将顶点转换到 NDC，以便进行后续处理：</p><div class="code-block" data-lang="glsl">
vec4 linePosStart = projectionMatrix * (modelViewMatrix * vec4(vaPosition, 1.0) * VIEW_SCALE);
vec4 linePosEnd = projectionMatrix * (modelViewMatrix * vec4(vaPosition + vaNormal, 1.0) * VIEW_SCALE);

vec3 ndc1 = linePosStart.xyz / linePosStart.w;
vec3 ndc2 = linePosEnd.xyz / linePosEnd.w;
</div><p id="xg7ug7_355"><code class="code" id="xg7ug7_394">linePosStart</code> 很好理解，就是线框顶点的位置。 <code class="code" id="xg7ug7_395">linePosEnd</code> 主要是为了转换到 <code class="code" id="xg7ug7_396">ndc2</code> 并与 <code class="code" id="xg7ug7_397">ndc1</code> 做差以间接求得线条在屏幕上的朝向 <span id="xg7ug7_398"><sup class="superscript"><span class="control" id="xg7ug7_399">1</span></sup></span>：</p><div class="code-block" data-lang="glsl">
vec2 lineScreenDirection = normalize(ndc2.xy - ndc1.xy);
</div><p id="xg7ug7_357">最后翻转顶点坐标就能求得其在二维平面上的垂直方向，即在屏幕上间接&ldquo;加粗&rdquo;线框需要偏移的方向：</p><div class="code-block" data-lang="glsl">
vec2 lineOffset = vec2(-lineScreenDirection.y, lineScreenDirection.x) * LineWidth / screenSize;
</div><p id="xg7ug7_359">这里我们对其中一个坐标取反，以便得到三维空间中正确的偏移方向 <span id="xg7ug7_400"><sup class="superscript"><span class="control" id="xg7ug7_401">2</span></sup></span> ，然后乘以相对屏幕尺寸的线条宽度，即获得了顶点需要横向偏移的距离。</p><aside class="prompt" data-type="tip" data-title="" id="xg7ug7_360"><p id="xg7ug7_402">在原版中，处理好了偏移量之后还设置了一个取反轴如果小于 0 则取反偏移量的操作：</p><div class="code-block" data-lang="glsl">
if (lineOffset.x &lt; 0.0) {
    lineOffset *= -1.0;
}
</div><p id="xg7ug7_404">但是其没有使用背面剔除，所以不需要这个判定。</p></aside><p id="xg7ug7_361">最后，判定顶点的 ID，如果是偶数则取反偏移量以便朝另一边扩展 <span id="xg7ug7_405"><sup class="superscript"><span class="control" id="xg7ug7_407">3</span></sup></span> 。具体操作为对顶点 ID 取 2 的模，如果是偶数则值为 0，即需要反转偏移方向，否则为 1。则我们可以将其减 0.5 再乘 2，就获得了乘数 -1 或 1。最后将偏移量加到顶点 NDC 坐标上，再逆转透视除法 <span id="xg7ug7_406"><sup class="superscript"><span class="control" id="xg7ug7_408">4</span></sup></span> ，就得到了最终的线框。</p><div class="code-block" data-lang="glsl">
lineOffset *= ((gl_VertexID % 2) - 0.5) * 2.0;
gl_Position = vec4((ndc1 + vec3(lineOffset, 0.0)) * linePosStart.w, linePosStart.w);
</div><p id="xg7ug7_363"><span class="control" id="xg7ug7_409">[1]</span> 顶点着色器无法访问其他顶点，因此线框的法线方向指向它边框的朝向，以便获取朝向。 <span class="control" id="xg7ug7_410">因此我们也无法将它们的法线信息用于处理光照</span>！ <br><span class="control" id="xg7ug7_412">[2]</span> 如果不取反其中一个轴，最终的朝向与我们的视野无法对齐，会导致奇怪的观感： <figure id="xg7ug7_413"><img alt="翻转偏移坐标" src="MGC_Docs/soildGbuffer_negativeOffset.webp" title="翻转偏移坐标" width="700" height="394"></figure></p><p id="xg7ug7_364"><span class="control" id="xg7ug7_414">[3]</span> 可以这样做的理由是，线框的每组偶数顶点与奇数顶点都在同一个位置，始末两端都有两个顶点，因此每个线框上有两个朝向相反的三角形 <span id="xg7ug7_415"><sup class="superscript"><span class="control" id="xg7ug7_417">5</span></sup></span> 。ID 为偶数的顶点反向偏移，这样横向偏移方向相同的顶点奇偶性也相同，最终就能拼凑出一个平面。也因此只需要一个法线朝向（而不是两个三角形因为 ID 奇偶性不同而需要两个相反的法线数据）即可正确偏移。在下面这张图里，我们将顶点颜色按其在内部三角形上的排列顺序设置为了 RGB，可以很明显看出第二个顶点都处在对应三角形的反方向，而整个平面由两个三角面组成： <figure id="xg7ug7_416"><img alt="三角形内部顶点序号" src="MGC_Docs/soildGbuffer_triangleForming.webp" title="三角形内部顶点序号" width="700" height="394"></figure></p><p id="xg7ug7_365"><span class="control" id="xg7ug7_418">[4]</span> 顶点着色器结束之后会自动进行透视除法，因此一定要记得逆转提前手动进行的透视除法，并正确设置 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.62ex" height="1.027ex" role="img" focusable="false" viewBox="0 -443 716 454"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g></g></g></svg></mjx-container> 分量！ <br><span class="control" id="xg7ug7_421">[5]</span> 虽然条带只有 4 个顶点，但是每相邻产生的三个顶点都会自动拼合一个三角形，这里使用了<span class="control" id="xg7ug7_422">几何着色器</span>来给每个拼合出来的三角形的内部顶点 <span id="xg7ug7_423"><sup class="superscript"><span class="control" id="xg7ug7_428">6</span></sup></span> 染色。你可以自行尝试将线框宽度拉大，然后观察将顶点颜色更改为 <code class="code" id="xg7ug7_424">vec3(gl_VertexID % 4)</code> 和 <code class="code" id="xg7ug7_425">vec3(gl_VertexID % 2)</code> 时变为黑色的顶点。 <br><span class="control" id="xg7ug7_427">[6]</span> 拼接之后的三角形传入几何着色器时会自动生成独立的顶点，并在内部生成独立索引，因此顶点着色器传出的变量在几何着色器要求被声明为数组类型，以便访问。</p><aside class="prompt" data-type="tip" data-title="" id="xg7ug7_366"><p id="xg7ug7_429">由于顶点只会在屏幕朝向的垂直方向上扩展，其边缘并不能完美拼合，再加上渲染线框时没有进行半透明排序，因此当线框宽度过大时视觉瑕疵会陡增。</p></aside><p id="xg7ug7_367">如果你想在片段着色器中禁用深度写入，可以使用：</p><div class="code-block" data-lang="glsl">
float depth = texelFetch(depthtex0, ivec2(gl_FragCoord.xy), 0).r;
gl_FragDepth = max(depth, gl_FragCoord.z);
</div><p id="xg7ug7_369">即当线框相比之前几何缓冲写入片段的更靠近摄像机时，我们将当前的深度设置为之前几何缓冲的深度（相当于不覆写深度信息），否则照常写入当前片段的 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.052ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 465 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g></svg></mjx-container> 坐标（照常进行深度测试，因为被遮挡，线框片段会被丢弃）。</p><p id="xg7ug7_370">线框的专用几何缓冲程序我们保存在 <code class="code" id="xg7ug7_431">gbuffers_line.glsl</code> 中。</p></section><section class="chapter"><h2 id="xg7ug7_15" data-toc="xg7ug7_15">习题</h2><ol class="list _decimal" id="xg7ug7_432" type="1"><li class="list__item" id="xg7ug7_436"><p id="xg7ug7_440">将法线通道和光照强度存入同一个缓冲区，法线的第三分量可以使用 <code class="code" id="xg7ug7_441">sqrt(1.0 - dot(normal.xy, normal.xy))</code> 进行重建，设置纹理格式时应该以值域范围大的内容为准。</p></li><li class="list__item" id="xg7ug7_437"><p id="xg7ug7_442">消化消化线框几何的相关内容，你也可以尝试自己修改 <code class="code" id="xg7ug7_443">VIEW_SHRINK</code> 和 <code class="code" id="xg7ug7_444">LineWidth</code> 值，以及尝试更改线框颜色。</p></li><li class="list__item" id="xg7ug7_438"><p id="xg7ug7_445">如果你仔细的话，可能会发现第二轮几何缓冲的雨雪和破坏粒子以及手持的半透明方块以一种非常鬼畜的形态回来了，一下雨就伸手不见五指。这是因为第二轮几何缓冲的大多数程序都会回退到 <code class="code" id="xg7ug7_447">textured</code> 上，而它本身又会回退到 <code class="code" id="xg7ug7_448">basic</code> ，因此记得像我们之前那样新建一个 <code class="code" id="xg7ug7_449">gbuffers_textured.fsh</code> 然后丢弃所有片段！</p><ul class="list _bullet" id="xg7ug7_446"><li class="list__item" id="xg7ug7_450"><p id="xg7ug7_451">此外， <code class="code" id="xg7ug7_452">water</code> 会回退到 <code class="code" id="xg7ug7_453">terrain</code> 上，但是我们之前已经丢弃过了，而 <code class="code" id="xg7ug7_454">hand_water</code> 则会回退到 <code class="code" id="xg7ug7_455">hand</code> 上，因此也需要额外丢弃。</p></li></ul></li><li class="list__item" id="xg7ug7_439"><p id="xg7ug7_456">尝试将每个 ID 所代表的内容设置为一个常量，保存在 <code class="code" id="xg7ug7_458">Settings.glsl</code> 中，也相当于做一个助记，比如：</p><div class="code-block" data-lang="glsl">
[... Settings.glsl ...]
const struct GID {
    int background;
    int commons;
    int invisible_entities;
    int glowing_entities;
    int noLighting;
} geoID_enum = GID(0,1,2,3,4); // GLSL 的快速初始化
[... gbuffers_aoLess.glsl ...]
geometryID = geoID_enum.commons;
[... gbuffers_line.glsl ...]
geometryID = geoID_enum.noLighting;
</div></li></ol><p id="xg7ug7_434">希望你还没有被这么多几何缓冲搞晕。至此，我们第一轮的几何缓冲程序就全部编写完毕了。在下一节中，我们将会认识直接写入缓冲区的图像类型和多延迟处理程序绘制。</p><p id="xg7ug7_435"><figure id="xg7ug7_459"><img alt="欢迎回来，固体几何！" src="MGC_Docs/soildGbuffer_finish.webp" title="欢迎回来，固体几何！" width="700" height="394"></figure> 别忘记欣赏欣赏我们处理完毕的场景！</p></section><div class="last-modified">11 April 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="1-4-realtimelighting.html" class="navigation-links__prev">动态场景照明</a><a href="a01-uniformsandats.html" class="navigation-links__next">OptiFine 提供的数据</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="frontend/app.js"></script></body></html>