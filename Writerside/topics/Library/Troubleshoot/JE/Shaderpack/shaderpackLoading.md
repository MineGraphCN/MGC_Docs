# 光影加载问题

<primary-label ref="manual"/>

<secondary-label ref="jeDoc"/>
<secondary-label ref="ofDoc"/>
<secondary-label ref="irisDoc"/>
<secondary-label ref="shaderDoc"/>

## 加载光影后帧率远低于预期

可搭配任务管理器分三步检查。

1. 检查 **GPU 占用** ：
   - 在游戏内的 <shortcut>F3</shortcut> 信息界面或任务管理器 GPU 页可查看显卡使用率；
   - 若发现核显运行满载而独立显卡空闲，则需在系统设置中启用高性能电源计划，或 [检查你的 GPU 驱动和 Windows 设置是否正确](troubleshootCommon.md#selGPU){summary=""} 。
   - 若独显使用率为 **100%** ，但帧率仍然低于同水平硬件，则可直接跳至第三步检查 RAM 占用；
   - 若独显使用率低于 **80%** ，则可能是下方两个部件达到了瓶颈状态，或是第四点的特殊情况。 
2. 检查 **CPU 占用** ：
   - <shortcut>右键</shortcut> 任务管理器中 CPU 的占用曲线图，将图形更改为 `逻辑处理器` ；
   - 如果你发现**其中一个线程是满载**，那一般是因为 CPU 出现瓶颈，性能不足以调用全部 GPU 的性能；
   - 原因一般是使用了**模组过多的整合包**或**分辨率过高/贴图数量过多的纹理包**。可根据具体情况逐个调整，减少 CPU 的负载。
3. 检查 **内存（RAM）占用** ：
   - 检查任务管理器中 `已提交` 的内存是否已经**超过了你的物理内存容量**；
   - `已提交的总内存` = `内存条容量` + `系统从磁盘中划分的虚拟内存` ，虚拟内存仅能做到不让游戏崩溃，由于磁盘 IO 传输速率与运行内存带宽差距较大，两者无法互相平替；
   - 若已超过，此时你需要更换容量更大的内存条，或调整游戏内的光影包、资源包、模组包以减少内存占用。
4. 特殊情况：
   - 部分光影（如 BSL）本身就难以使 GPU 达到满载，但由于其运算量少，也难以做到帧率低；
   - **不要在一个区块停留过久**，尤其是一些方块物品数量过多的基地，可能会消耗过多的 CPU 或别的部件性能，从而导致无法调用全部 GPU 渲染；
   - 部分独立显卡会提供驱动或硬件开关调整其运行模式。将其改为游戏模式即可发挥显卡全部性能。

## 选择界面没有找到光影／选择光影后没有效果

- **光影包可能出现损坏，需要重新下载**
  - 一些浏览器（如 Safari）默认不能正确处理压缩文件。你可以尝试关闭 `下载后打开安全文件`（只适用于 Safari），或者使用不同的浏览器，如火狐或谷歌。
- **光影包被放置在错误的文件夹中**
  - 请检查你的光影包放置路径是否正确。
  - 如果开启了 `版本独立` ，则游戏的读取目录在 `.minecraft/versions/` 文件夹下对应的游戏版本文件夹中。
  - 建议在游戏内从 `视频设置` > `光影` > `光影包文件夹` <sup>OptiFine</sup> 或 `视频设置` > `光影包` > `打开光影包文件夹` <sup>Iris</sup> 直接访问。
  - Canvas MOD 使用资源包作为光影加载途径，注意不要将 Canvas 光影与 OptiFine / Iris 光影混用，也不要将 Canvas 光影放入 `shaderpacks` 文件夹，或将 OptiFine / Iris 光影放入 `resourcepacks` 文件夹。
- **光影包读取出现问题**
  - 尝试将光影包解压之后再加载。有时光影包可能被压缩为错误的格式（如 `.rar` 或 `.7z` ）或进行了加密，导致光影在压缩包状态下无法被正常读取。
    > 光影作者通常不会这样做，如果你获取到了这两种压缩包，可能并非作者渠道，甚至涉嫌倒卖！
  - 若使用的光影模组是 Iris，可尝试切换为其它光影如 BSL、Complementary Shader 等。该模组本身就不兼容许多光影，也不适合作为大多数入门玩家的第一选择。
  - 若同时伴随着左下角的**一大串报错**，同时在切换光影界面的底部看到显卡型号为 Intel 核心显卡（非 Arc 系列的显卡），同时如果你**确认**你的电脑有独立显卡，则可能说明你没有正确配置显卡。参考 [通用问题 - 独立显卡没有正确启用](troubleshootCommon.md#独立显卡没有正确启用){summary=""} 解决。
    > 事实上比较新的核心显卡已经不会在大多数时候报错了，如果你确认你的核心显卡型号比较新，则可能是其他原因。
  - 若读取时提示 `需要更新至 OptiFine Z1 版本` ，而 OptiFine 已发布的最新版本号**远低于**该版本时，意味着这个光影可能只支持 **JE 1.16.5 G7** 及以上的 OptiFine。如果目前使用的是 **JE 1.12.2** 客户端，可以尝试通过添加 [Advanced Shader](terms.md#advancedShader){summary=""} 模组来解决问题。
- **光影包的结构错误**
  - OptiFine 和 Iris 会遍历 `shaderpacks` 下的文件夹和 `.zip` 压缩包，将所有包含 `shaders` 文件夹的内容都视为光影外壳（下称**外壳文件夹**）。
  - OptiFine 会先寻找外壳文件夹，然后在外壳内寻找 `shaders` 文件夹，因此，如果将一个包含着色器文件的 `shaders` 文件夹直接放在 `shaderpacks` 下，或者外壳文件夹内还嵌套了一个文件夹，则不会读取。
    - 老版本的 OptiFine 会认为前者的名字就叫 *shaders*，并把它视为外壳文件夹，然后试图寻找这个外壳文件夹中的 `shaders` 文件夹；如果是后者的情况，由于 OptiFine 只会试图在第一层外壳下寻找 `shaders` 文件夹。这两种情况都会导致光影虽然显示在列表中，却无法正确加载。

你可以按照这个目录来检查你的光影是否安装正确：

<include from="uniforms.md" element-id="shaderpack_structure_simple"/>

[//]: # (TODO)

[//]: # (## 启用光影后画面出现问题／出现了不兼容的情况)

## 游戏聊天栏报告 `OpenGL ERROR`

|  错误代码  | 原因      | 解决方法                     |
|:------:|---------|:-------------------------|
| `1281` | 无效值     | 关闭 `替选方块` ，禁用部分可能引起冲突的模组 |
| `1282` | 无效操作    | 更换光影或其他版本的高清修复           |
| `1283` | 栈溢出     | 检查并移除互相冲突的模组             |
| `1284` | 栈下溢     | 更新显卡驱动，禁用可能引起冲突的模组或光影    |
| `1285` | 显存不足    | 停止使用资源包或光影，升级硬件          |
| `1286` | 无效帧缓冲操作 | 更新 Java ，或重新下载客户端        |

> 本表引自 Copilot，解决方法仅供参考。
> 
{style="note"}

> 聊天记录报告 `OpenGL Error` 在大多数情况下都可以忽略，与 OptiFine 光影无关。如果这些信息打扰了你，你可以通过关闭 `视频设置` > `其他` > `显示GL错误` 来禁用它们。
> 
> 隐藏 GL 错误不会隐藏 OptiFine 报告的光影错误。

## 开光影后游戏崩溃

- 有两种原因：**游戏进程崩溃**，和 **Java 虚拟机崩溃**。这两种类型都会产生一个崩溃日志文件，而这个崩溃日志对于诊断问题是**绝对必要**的。
  - **游戏进程崩溃**会把这个文件放在 `.minecraft/crash-reports/crash-(date)-(time)-(client or server).txt` ；
  - **Java虚拟机崩溃**会把这个文件放在 `.minecraft/hs_err_pid(number).log` 。
- 对于**游戏进程崩溃**，如果崩溃日志显示 `java.lang.NoSuchFieldError: field_191308_b` ，而你的版本是 **JE 1.12.2**，那么有两种方法可以解决这个问题：
  - 更新到最新的 OptiFine 版本。你需要在 OptiFine 的下载页面上点击 "显示所有版本"，以便找到 **JE 1.12.2** 的版本。
  - 删除光影包内的 `/shaders/entity.properties` 。你需要解压缩光影的压缩文件，以便修改其内容。如果你的崩溃日志没有提到这两个特定的错误，那么请在求助频道中上传日志并询问它。
- 对于 **Java 虚拟机崩溃**，请打开崩溃日志并在顶部搜索关键词。如果提到了 `antio6axx.dll` ，那么你需要将你的 AMD 驱动降级到 `20.4.2` 版本。此外，截至2022年11月末，如果 AMD 用户在**加载一些光影时**游戏崩溃，可以优先尝试将显卡驱动降回 `22.6.1` 或 `22.5.1` 版本。如果降级不能解决你的问题，或者问题是其他东西，那么请在主聊天频道中上传日志并询问它。
- 如果你不知道你的崩溃原因，请检查这两个文件。如果你有一个以上的崩溃日志，而你不知道哪一个是正确的，请删除所有现有的崩溃日志并再次启动游戏。当它第二次崩溃时，将只有一个崩溃日志在两个地方之一。如果你看不懂，请将它发到求助频道寻求帮助。

## 游戏未崩溃，但画面看起来不正常

- **所有光影都不保证加载了就能正常使用**。有时，它可能与你的显卡、图形驱动或其他已安装的模组不兼容。
- 如果一个光影编译失败，当你启用该光影包时，你会在聊天菜单中看到 `invalid program` 报告。然而，它不会告诉你实际问题是什么。对于这一点，你需要查看你的日志文件。
  - 如果你安装了 Forge，这可以在 `.minecraft/logs/fml-client-latest.log` 中找到。
  - 否则，就在 `.minecraft/logs/latest.log` 中。
- 把这个日志文件上传到主聊天频道，我们会帮你找出问题所在。如果可以，最好**重启客户端，加载一次光影后关闭再上传你的日志**。这样，有问题的日志会处于最后，错误信息也不容易被其他的信息掩盖，更容易定位。
- 如果你没有任何无效的程序，接下来要检查的是模组。试着用**只有 OptiFine 的纯净版本**来运行光影包，而不使用其他东西，不要启动 Forge 版本。如果它正常了，那就可能是模组的问题了。幸运的是，大多数模组都有配置选项，可以让你在不删除整个模组的情况下禁用有问题的模组功能。配置文件可以在 `.minecraft/config` 中找到。
- 在 **JE 1.13** 以上版本中，Forge 配置文件被分成客户端、服务器和普通配置文件。不是每个模组都会有所有这三个文件。在遇到问题时，应优先打开 `客户端配置文件` 。如果模组没有客户端的配置文件，再试试 `普通配置文件` 。**不要尝试通过修改服务器配置文件来修复这个问题**。

<seealso>
  <category ref="related">
    <a href="videoSettings.md" summary="这篇文档列出了整个视频设置选项卡中容易出现问题的设置以及修改建议。">视频设置和相关显示问题</a>
    <a href="modsCompatibility.md" summary="这篇文档列出了我们所知的模组和光影间兼容性冲突的解决办法。">光影和模组兼容性</a>
  </category>
</seealso>
